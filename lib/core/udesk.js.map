{"version":3,"sources":["../../src/core/udesk.js"],"names":["UdeskJSApi","getSignature","queryWithParams","UdeskJS","store","_store","clearCustomer","customer","customerUrl","setCustomer","map","console","log","c_email","c_phone","customer_token","c_id","singId","Error","nonce","timestamp","web_token","signature","im_user_key","url","getProductUrl","product_title","getProductUrlAutoPrefix","title","productMap","key","p_key","p_value","getTicketUrl","t_priority_id","getNoneProductUrl","image","send","toServiceIM","c_cf_站点来源","document","origin","lastUrl","link","UdeskGotoUrl","websiteToSearch","word","companyDomain","plugInToSearch","encodeUrl","encodeURI","window","location"],"mappings":"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","file":"udesk.js","sourcesContent":["import UdeskJSApi from '../services/udesk-js-api';\r\nimport getSignature from './signature';\r\nimport queryWithParams from '../utils/query-with-params';\r\n\r\nexport default class UdeskJS {\r\n\r\n  static get store() {\r\n    if (!this._store) {\r\n      this._store = {};\r\n    }\r\n    return this._store;\r\n  }\r\n\r\n  static clearCustomer() {\r\n    this.store.customer = null;\r\n    this.store.customerUrl = '';\r\n  }\r\n\r\n  static setCustomer(map) {\r\n    if (!map || typeof map != 'object') {\r\n      console.log('js-udesk-link [UdeskJS] -> setCustomer(map) -> map=null');\r\n      this.store.customer = null;\r\n      this.store.customerUrl = '';\r\n      return;\r\n    }\r\n    let c_email = map.c_email;\r\n    let c_phone = map.c_phone;\r\n    let customer_token = map.customer_token;\r\n    let c_id = map.c_id; // sdk 专门为签名 扩展的字段\r\n    let singId = '';\r\n    if (c_email) singId = c_email;\r\n    else if (c_phone) singId = c_phone;\r\n    else if (customer_token) singId = customer_token;\r\n    else if (c_id) singId = c_id;\r\n\r\n    if (!singId) {\r\n      throw new Error('js-udesk-link [UdeskJS] -> setCustomer(map) -> singId=null');\r\n    }\r\n    const {nonce, timestamp, web_token, signature, im_user_key} = getSignature(singId);\r\n    map.nonce = nonce;\r\n    map.timestamp = timestamp;\r\n    map.web_token = web_token;\r\n    map.signature = signature;\r\n    map.im_user_key = im_user_key;\r\n\r\n    let url = queryWithParams(map);\r\n    this.store.customer = map;\r\n    this.store.customerUrl = url;\r\n  }\r\n\r\n  // 咨询对象\r\n  static getProductUrl(map) {\r\n    if (!map || typeof map != 'object') {\r\n      console.log('js-udesk-link [UdeskJS] -> getProductUrl(map) -> map=null');\r\n      return '';\r\n    }\r\n\r\n    let product_title = map.product_title;\r\n    if (typeof product_title === 'undefined') {\r\n      throw new Error('js-udesk-link [UdeskJS] -> getProductUrl(map) -> product_title=null');\r\n    }\r\n    let url = queryWithParams(map);\r\n    return url;\r\n  }\r\n  \r\n  // 咨询对象 - 自动添加前缀\r\n  static getProductUrlAutoPrefix(map) {\r\n    if (!map || typeof map != 'object') {\r\n      console.log('js-udesk-link [UdeskJS] -> getProductUrlAutoPrefix(map) -> map=null');\r\n      return ''\r\n    }\r\n\r\n    let title = map.title;\r\n    if (typeof title === 'undefined') {\r\n      throw new Error('js-udesk-link [UdeskJS] -> getProductUrlAutoPrefix(map) -> title=null');\r\n    }\r\n\r\n    let productMap = {};\r\n    for (let key in map) {\r\n      let p_key = 'product_' + key;\r\n      let p_value = map[key] || '';\r\n      productMap[p_key] = p_value;\r\n    }\r\n    return this.getProductUrl(productMap)\r\n  }\r\n\r\n  // 工单信息\r\n  static getTicketUrl(map) {\r\n    if (!map || typeof map != 'object') {\r\n      console.log('js-udesk-link [UdeskJS] -> getTicketUrl(map) -> map=null');\r\n      return ''\r\n    }\r\n\r\n    let t_priority_id = map.t_priority_id;\r\n    if (!t_priority_id) {\r\n      throw new Error('js-udesk-link [UdeskJS] -> getTicketUrl(map) -> t_priority_id=null');\r\n    }\r\n    let url = queryWithParams(map);\r\n    return url;\r\n  }\r\n\r\n  static getNoneProductUrl() {\r\n    let map = {\r\n      title: \" \",\r\n      url: \" \",\r\n      image: \" \",\r\n      send: false\r\n    }\r\n    let url = this.getProductUrlAutoPrefix(map);\r\n    return url;\r\n  }\r\n\r\n  static toServiceIM(url) {\r\n    url = url || ''\r\n    if (url) url = '&' + url;\r\n    let customerUrl = this.store.customerUrl || '';\r\n    if (customerUrl) {\r\n      customerUrl = '&' + customerUrl;\r\n    }\r\n    let c_cf_站点来源 = document.origin;\r\n    let lastUrl = UdeskJSApi.link + customerUrl + url + '&c_cf_站点来源=' + c_cf_站点来源;\r\n    this.UdeskGotoUrl(lastUrl)\r\n  }\r\n\r\n  // 自定义搜索关键词 - 第三方网站链接示例（如：公司官网）\r\n  static websiteToSearch(word) {\r\n    let companyDomain = UdeskJSApi.companyDomain || '';\r\n    word = word || '';\r\n    let url = 'https://www.'+ companyDomain +'.com?udesk_wd=' + word;\r\n    this.UdeskGotoUrl(url)\r\n  }\r\n  // 自定义搜索关键词 - 网页插件链接示例\r\n  static plugInToSearch(word) {\r\n    let companyDomain = UdeskJSApi.companyDomain || '';\r\n    word = word || '';\r\n    let url = 'https://'+ companyDomain +'.udesk.cn/im_client/?udesk_wd=' + word;\r\n    this.UdeskGotoUrl(url)\r\n  }\r\n\r\n  static UdeskGotoUrl(url) {\r\n    let encodeUrl = encodeURI(url);\r\n    window.location = encodeUrl;\r\n  }\r\n}"]}